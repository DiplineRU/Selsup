# CrptApi

## üìå –ó–∞–¥–∞–Ω–∏–µ
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞ —è–∑—ã–∫–µ Java (–≤–µ—Ä—Å–∏–∏ 11+) –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –ß–µ—Å—Ç–Ω–æ–≥–æ –∑–Ω–∞–∫–∞.  
–ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
- –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º,  
- –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API,  
- —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–º.  

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∑–∞–¥–∞—ë—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—Ä–µ–º–µ–Ω–∏:
  ```java
  public CrptApi(TimeUnit timeUnit, int requestLimit)
  ```
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å **–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è**, –ø–æ–∫–∞ –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è ¬´–æ–∫–Ω–æ¬ª.
- –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è **—Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤–≤–æ–¥–∞ –≤ –æ–±–æ—Ä–æ—Ç** —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–∏–∑–≤–µ–¥—ë–Ω–Ω–æ–≥–æ –≤ –†–§.  
- –î–æ–∫—É–º–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –≤–∏–¥–µ Java-–æ–±—ä–µ–∫—Ç–∞, –ø–æ–¥–ø–∏—Å—å ‚Äî —Å—Ç—Ä–æ–∫–æ–π.  
- –í—Å–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏.  
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ `CrptApi.java`.

---

## üõ† –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
–§–∞–π–ª `CrptApi.java` —Å–æ–¥–µ—Ä–∂–∏—Ç:
- `CrptApi` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –∫–ª–∏–µ–Ω—Ç–∞.
- `RateLimiter` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏ (Sliding Window).
- `Serializer` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä JSON:
  - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Jackson, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ classpath;
  - –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≥–æ—Ç–æ–≤—É—é JSON-—Å—Ç—Ä–æ–∫—É.

### –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
```java
CrptApi(String baseUrl, String bearerToken, TimeUnit timeUnit, int requestLimit)
CrptApi(String baseUrl, TimeUnit timeUnit, int requestLimit) // –±–µ–∑ —Ç–æ–∫–µ–Ω–∞
```

### –ú–µ—Ç–æ–¥—ã
```java
// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
HttpResponse<String> createDocument(String path, Object document, String signature)

// –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è "–í–≤–æ–¥ –≤ –æ–±–æ—Ä–æ—Ç"
HttpResponse<String> createIntroduceGoods(Object document, String signature)
```

- `path` ‚Äî –ø—É—Ç—å API (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/api/v3/lk/documents/create`).
- `document` ‚Äî Java Map/POJO –∏–ª–∏ –≥–æ—Ç–æ–≤–∞—è JSON-—Å—Ç—Ä–æ–∫–∞.
- `signature` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–ø–∏—Å–∏.

---

## üöÄ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```java
public static void main(String[] args) throws Exception {
    CrptApi api = new CrptApi("https://httpbin.org", null, TimeUnit.SECONDS, 5);

    Map<String, Object> document = new HashMap<>();
    document.put("doc_type", "LP_INTRODUCE_GOODS");
    document.put("participant_inn", "1234567890");

    String signature = "base64-signature-string";

    HttpResponse<String> resp = api.createDocument("/post", document, signature);
    System.out.println(resp.statusCode());
    System.out.println(resp.body());
}
```

üëâ –í –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `https://httpbin.org/post` –∫–∞–∫ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å.  
–û–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 –∏ –ø–µ—á–∞—Ç–∞–µ—Ç JSON —Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

---

## üì¶ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### Maven
–í `pom.xml` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:
```xml
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.17.2</version>
</dependency>
```

–ó–∞–ø—É—Å–∫:
```bash
mvn clean package
java -cp target/SelsUp-0.0.1-SNAPSHOT.jar com.example.SelsUp.CrptApi
```

### IntelliJ IDEA
- –û—Ç–∫—Ä–æ–π –ø—Ä–æ–µ–∫—Ç –∫–∞–∫ Maven.  
- –ó–∞–ø—É—Å—Ç–∏ `CrptApi.main`.  

---

## ‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ API –ß–µ—Å—Ç–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
- –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å:
  ```java
  new CrptApi("https://ismp.crpt.ru", "REAL_BEARER_TOKEN", TimeUnit.SECONDS, 5);
  ```
- `document` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`doc_id`, `description`, `products`, `owner_inn`, `producer_inn` –∏ —Ç. –¥.).
- –ú–µ—Ç–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `/api/v3/lk/documents/create`.
- –ë–µ–∑ –≤–∞–ª–∏–¥–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ `Bearer` —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—ë—Ç `401 Unauthorized`.

---

## ‚úÖ –ò—Ç–æ–≥
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–¥–∞–Ω–∏—é: –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, rate-limit, –µ–¥–∏–Ω—ã–π —Ñ–∞–π–ª.  
- –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω —Å `httpbin.org` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞.  
- –ì–æ—Ç–æ–≤ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–æ–µ–≤–æ–º—É API –ß–µ—Å—Ç–Ω–æ–≥–æ –∑–Ω–∞–∫–∞.
